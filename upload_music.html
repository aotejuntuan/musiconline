<!DOCTYPE html>
<html>
<head>
    <title>Upload - Cloud music</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="css/bootstrap.min.css"/>
    <link rel="stylesheet" href="css/font-awesome.min.css"/>
    <link rel="stylesheet" href="css/layout.css"/>
    <script src="js/jquery-3.0.0.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
</head>
<body>
<form id="uploadForm" action="upload_music.php" method="POST" enctype="multipart/form-data">
    <p>填写歌曲详细信息 </p>
    <p>歌曲 : <input type="text" name="name" required/></p>
    <p>作家 : <input type="text" name="autor" required/></p>
    <p>上传文件 : <input type="file" name="userfile" required accept="audio/mpeg"/></p>
    <p><input id="submit" type="submit" value="上传"/></p>
</form>
<progress id="prog" value="0"></progress>
<span id="progress"> 0%</span>
<div class="progress" style="width:30%">
    <div id="prog1" class="progress-bar progress-bar-success progress-bar-striped" role="progressbar"
         style="width: 0">
        <span class="sr-only"></span>
    </div>
</div>
<div id="myDiv">

</div>
<script>
    /**
     * Ajax上传数据进度条
     * @type {handleButtonPress}
     */
    document.getElementById("submit").onclick = handleButtonPress;
    function handleButtonPress(event) {
        event.preventDefault();
        var form = document.getElementById("uploadForm");
        var progress = document.getElementById("prog");
        var progress1 = document.getElementById("prog1");
        var value = document.getElementById("progress");
        var formData = new FormData(form);

        var xmlhttp;
        if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {// code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }

        var upload = xmlhttp.upload;
        upload.onprogress = function (e) {
            progress.max = e.total;
            progress.value = e.loaded;
            var sum = Math.round((progress.value / progress.max) * 100);
            value.innerHTML = sum + "%";
            progress1.style.width = sum + "%";
        };
        upload.onload = function (e) {
            progress.value = 1;
            progress.max = 1;
        };

        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                document.getElementById("myDiv").innerHTML = xmlhttp.responseText;
            }
        };
        xmlhttp.open("POST", form.action, true);
        xmlhttp.send(formData);
    }
</script>
</body>
</html>